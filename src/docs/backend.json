
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Ndara Afrique application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the user (Firebase Auth ID). This is the primary key.",
          "format": "uuid"
        },
        "username": {
            "type": "string",
            "description": "Unique, public-facing username for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user (private).",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the user (private)."
        },
        "profilePictureURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
            "type": "string",
            "description": "A short biography for the user, especially for instructors."
        },
        "socialLinks": {
            "type": "object",
            "description": "URLs to the user's social media profiles.",
            "properties": {
                "website": { "type": "string", "format": "uri" },
                "twitter": { "type": "string", "format": "uri" },
                "linkedin": { "type": "string", "format": "uri" },
                "youtube": { "type": "string", "format": "uri" }
            }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (student, instructor, or admin).",
          "enum": ["student", "instructor", "admin"]
        },
        "status": {
            "type": "string",
            "description": "The current status of the user account.",
            "enum": ["active", "suspended"]
        },
        "isInstructorApproved": {
          "type": "boolean",
          "description": "Indicates whether the instructor's account has been approved by an admin."
        },
        "careerGoals": {
            "type": "object",
            "description": "User's career goals and interests. The `interestDomain` is used for chat matchmaking.",
            "properties": {
                "currentRole": { "type": "string" },
                "interestDomain": { "type": "string", "description": "Used to match students with others in the same field of study." },
                "mainGoal": { "type": "string" }
            }
        },
        "isProfileComplete": {
            "type": "boolean",
            "description": "Flag indicating if the user has completed the essential parts of their profile (e.g., username, career goals)."
        },
        "notificationPreferences": {
          "type": "object",
          "description": "Admin preferences for receiving push notifications.",
          "properties": {
            "newPayouts": { "type": "boolean", "default": true },
            "newApplications": { "type": "boolean", "default": true },
            "newSupportTickets": { "type": "boolean", "default": true },
            "financialAnomalies": { "type": "boolean", "default": true }
          }
        }
      },
      "required": [
        "uid",
        "email",
        "username",
        "createdAt",
        "role",
        "status",
        "isInstructorApproved"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered on the Ndara Afrique platform.",
      "properties": {
        "courseId": { "type": "string" },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "instructorId": { "type": "string" },
        "category": { "type": "string" },
        "price": { "type": "number" },
        "status": { "type": "string", "enum": ["Draft", "Published", "Pending Review"] }
      },
      "required": ["courseId", "title", "description", "instructorId", "category", "price", "status"]
    },
    "CourseProgress": {
      "title": "Course Progress",
      "type": "object",
      "description": "Tracks a student's progress in a specific course for the 'Continue Learning' section.",
      "properties": {
        "userId": { "type": "string", "description": "The student's UID." },
        "courseId": { "type": "string" },
        "courseTitle": { "type": "string" },
        "courseCover": { "type": "string", "format": "uri" },
        "lastLessonId": { "type": "string" },
        "lastLessonTitle": { "type": "string" },
        "progressPercent": { "type": "number", "description": "The completion percentage (0-100)." },
        "lastVideoTime": { "type": "number", "description": "The timestamp in seconds of the last video watched." },
        "updatedAt": { "type": "string", "format": "date-time", "description": "Timestamp of the last interaction." }
      },
      "required": ["userId", "courseId", "updatedAt", "progressPercent"]
    },
    "Chat": {
      "title": "Chat",
      "type": "object",
      "description": "Represents a conversation between two users.",
      "properties": {
        "participants": {
          "type": "array",
          "description": "An array containing the UIDs of the two users in the chat.",
          "items": { "type": "string" }
        },
        "participantCategories": {
            "type": "array",
            "description": "An array containing the `interestDomain` of both participants. Used for security rules.",
            "items": { "type": "string" }
        },
        "lastMessage": { "type": "string" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["participants", "participantCategories", "updatedAt"]
    },
    "Message": {
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a chat.",
      "properties": {
        "senderId": { "type": "string" },
        "text": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["senderId", "text", "createdAt"]
    },
    "Payout": {
        "title": "Payout",
        "type": "object",
        "description": "Represents an instructor's request to withdraw funds.",
        "properties": {
            "instructorId": { "type": "string" },
            "amount": { "type": "number" },
            "method": { "type": "string", "enum": ["Mobile Money", "Virement"] },
            "status": { "type": "string", "enum": ["en_attente", "valide", "rejete"] },
            "date": { "type": "string", "format": "date-time" }
        },
        "required": ["instructorId", "amount", "method", "status", "date"]
    },
    "PromoCode": {
      "title": "Promo Code",
      "type": "object",
      "description": "Represents a promotional code for discounts.",
      "properties": {
        "code": {
          "type": "string",
          "description": "The promo code string (e.g., 'AFRIQUE50')."
        },
        "discountPercentage": {
          "type": "number",
          "description": "The percentage discount (e.g., 50 for 50%)."
        },
        "isActive": {
          "type": "boolean",
          "description": "Whether the code is currently active."
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "Optional expiration date for the code."
        }
      },
      "required": ["code", "discountPercentage", "isActive"]
    },
    "CarouselSlide": {
      "title": "Carousel Slide",
      "type": "object",
      "description": "Represents a single slide in the homepage carousel.",
      "properties": {
        "imageUrl": { "type": "string", "format": "uri", "description": "URL of the slide image." },
        "link": { "type": "string", "format": "uri", "description": "Optional URL the slide links to." },
        "order": { "type": "number", "description": "The display order of the slide." }
      },
      "required": ["imageUrl", "order"]
    },
    "SubscriptionPlan": {
        "title": "Subscription Plan",
        "type": "object",
        "description": "Represents a subscription plan offered on the platform.",
        "properties": {
            "planId": { "type": "string", "description": "Unique identifier for the plan." },
            "name": { "type": "string", "description": "Public name of the plan (e.g., 'Ndara Pro')." },
            "description": { "type": "string" },
            "price": { "type": "number" },
            "billingCycle": { "type": "string", "enum": ["monthly", "yearly"] },
            "targetRole": { "type": "string", "enum": ["student", "instructor"] },
            "features": { "type": "array", "items": { "type": "string" } },
            "isActive": { "type": "boolean" }
        },
        "required": ["planId", "name", "price", "billingCycle", "targetRole", "isActive"]
    },
    "UserSubscription": {
        "title": "User Subscription",
        "type": "object",
        "description": "Represents a user's subscription to a plan.",
        "properties": {
            "subscriptionId": { "type": "string" },
            "userId": { "type": "string" },
            "planId": { "type": "string" },
            "status": { "type": "string", "enum": ["active", "canceled", "past_due", "expired"] },
            "startDate": { "type": "string", "format": "date-time" },
            "endDate": { "type": "string", "format": "date-time", "description": "The date when the current paid period ends." },
            "canceledAt": { "type": "string", "format": "date-time", "description": "The date when the user canceled the subscription." }
        },
        "required": ["subscriptionId", "userId", "planId", "status", "startDate", "endDate"]
    },
    "UserActivity": {
      "title": "User Activity",
      "type": "object",
      "description": "Represents a single event in a user's activity feed.",
      "properties": {
        "userId": { "type": "string", "description": "The ID of the user this activity belongs to." },
        "type": { "type": "string", "enum": ["enrollment", "certificate", "review", "assignment"], "description": "The type of activity event." },
        "title": { "type": "string", "description": "A short, displayable title for the activity." },
        "description": { "type": "string", "description": "A short description of the activity, if any." },
        "relatedId": { "type": "string", "description": "ID of the related entity (e.g., courseId, certificateId)." },
        "link": { "type": "string", "format": "uri", "description": "A direct link to the relevant page for this activity." },
        "read": { "type": "boolean", "default": false, "description": "Whether the user has seen this activity." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the activity occurred." }
      },
      "required": ["userId", "type", "title", "createdAt"]
    },
    "RecommendedCourseItem": {
      "title": "Recommended Course Item",
      "type": "object",
      "description": "Represents a single recommended course within a user's recommendation list.",
      "properties": {
        "courseId": { "type": "string" },
        "title": { "type": "string" },
        "coverImage": { "type": "string", "format": "uri" },
        "instructorId": { "type": "string" },
        "price": { "type": "number" },
        "score": { "type": "number", "description": "The recommendation score." },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["courseId", "title", "coverImage", "instructorId", "price"]
    },
    "UserRecommendations": {
      "title": "User Recommendations",
      "type": "object",
      "description": "A document containing a list of recommended courses for a specific user.",
      "properties": {
        "courses": {
          "type": "array",
          "items": {
            "$ref": "#/entities/RecommendedCourseItem"
          }
        },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["courses", "updatedAt"]
    },
    "Payment": {
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment transaction for a course enrollment.",
      "properties": {
        "userId": { "type": "string" },
        "instructorId": { "type": "string" },
        "courseId": { "type": "string" },
        "amount": { "type": "number" },
        "currency": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["Completed", "Pending", "Failed", "Refunded"] },
        "fraudReview": {
          "type": "object",
          "properties": {
            "isSuspicious": { "type": "boolean" },
            "riskScore": { "type": "number" },
            "reason": { "type": "string" },
            "checkedAt": { "type": "string", "format": "date-time" }
          }
        }
      },
      "required": ["userId", "instructorId", "courseId", "amount", "currency", "date", "status"]
    },
    "SecurityLog": {
      "title": "Security Log",
      "type": "object",
      "description": "Represents a security-related event.",
      "properties": {
        "eventType": { "type": "string", "enum": ["suspicious_login", "failed_payment", "profile_change"] },
        "userId": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "ipAddress": { "type": "string", "format": "ipv4" },
        "details": { "type": "string" }
      },
      "required": ["eventType", "userId", "timestamp"]
    }
  },
  "auth": {
    "providers": ["password", "google.com"]
  },
  "firestore": {
    "indexes": [
      {
        "collectionGroup": "users",
        "queryScope": "COLLECTION",
        "fields": [
          {"fieldPath": "role", "order": "ASCENDING"},
          {"fieldPath": "createdAt", "order": "DESCENDING"}
        ]
      },
      {
        "collectionGroup": "payouts",
        "queryScope": "COLLECTION",
        "fields": [
          {"fieldPath": "date", "order": "DESCENDING"}
        ]
      },
       {
        "collectionGroup": "support_tickets",
        "queryScope": "COLLECTION",
        "fields": [
          {"fieldPath": "updatedAt", "order": "DESCENDING"}
        ]
      },
      {
        "collectionGroup": "courses",
        "queryScope": "COLLECTION",
        "fields": [
          {"fieldPath": "status", "order": "ASCENDING"},
          {"fieldPath": "category", "order": "ASCENDING"},
          {"fieldPath": "createdAt", "order": "DESCENDING"}
        ]
      },
      {
        "collectionGroup": "payments",
        "queryScope": "COLLECTION",
        "fields": [
          { "fieldPath": "fraudReview.isSuspicious", "order": "ASCENDING" },
          { "fieldPath": "date", "order": "DESCENDING" }
        ]
      },
      {
        "collectionGroup": "payments",
        "queryScope": "COLLECTION",
        "fields": [
          { "fieldPath": "status", "order": "ASCENDING" },
          { "fieldPath": "date", "order": "DESCENDING" }
        ]
      },
      {
        "collectionGroup": "security_logs",
        "queryScope": "COLLECTION",
        "fields": [
          { "fieldPath": "eventType", "order": "ASCENDING" },
          { "fieldPath": "timestamp", "order": "DESCENDING" }
        ]
      }
    ],
    "/users/{userId}": {
      "schema": { "$ref": "#/entities/User" },
      "description": "Stores user profiles."
    },
    "/users/{userId}/subscriptions/{subscriptionId}": {
      "schema": { "$ref": "#/entities/UserSubscription" },
      "description": "Stores a user's subscription history."
    },
     "/users/{userId}/activity/{activityId}": {
      "schema": { "$ref": "#/entities/UserActivity" },
      "description": "Stores a user's specific activity events as a subcollection."
    },
    "/chats/{chatId}": {
      "schema": { "$ref": "#/entities/Chat" },
      "description": "Stores metadata for each conversation."
    },
    "/chats/{chatId}/messages/{messageId}": {
      "schema": { "$ref": "#/entities/Message" },
      "description": "Stores all messages for a specific conversation."
    },
    "/courses/{courseId}": {
      "schema": { "$ref": "#/entities/Course" },
      "description": "Stores course information."
    },
    "/course_progress/{progressId}": {
      "schema": { "$ref": "#/entities/CourseProgress" },
      "description": "Stores detailed student progress for quick resume."
    },
    "/payments/{paymentId}": {
      "schema": { "$ref": "#/entities/Payment" },
      "description": "Stores payment transaction records."
    },
    "/payouts/{payoutId}": {
        "schema": { "$ref": "#/entities/Payout" },
        "description": "Stores instructor payout requests."
    },
    "/promoCodes/{codeId}": {
        "schema": { "$ref": "#/entities/PromoCode" },
        "description": "Stores promotional codes for discounts."
    },
    "/carousel_slides/{slideId}": {
      "schema": { "$ref": "#/entities/CarouselSlide" },
      "description": "Stores the slides for the homepage carousel."
    },
    "/subscription_plans/{planId}": {
      "schema": { "$ref": "#/entities/SubscriptionPlan" },
      "description": "Stores available subscription plans."
    },
    "/recommended_courses/{userId}": {
      "schema": { "$ref": "#/entities/UserRecommendations" },
      "description": "Stores personalized course recommendations for each user."
    },
    "/security_logs/{logId}": {
      "schema": { "$ref": "#/entities/SecurityLog" },
      "description": "Stores security-related events for admin review."
    }
  }
}
